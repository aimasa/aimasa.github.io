---
title: 手写字体识别走过的坑
copyright: true
date: 2019-12-04 15:18:35
categories:
- 图像处理
- 手写识别
tags:
- 图像处理
---

运行的代码是：[哈工大大佬毕设代码](https://github.com/HuiyanWen/bysj_hit)

因为数据集他们没放出来，所以我选用的是中科院的手写数据集，特别有名的那个HWDB：[数据集trn](http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1trn_gnt.zip)，[数据集tst](http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1tst_gnt.zip)

其实这里也算是记录用`TensorFlow`实现图片处理经过的坑。名字而已，无需计较

<!--more-->

# 开门第一坑：缺少验证集

自己写了个脚本，以3:1的比例从trn中抽取出验证集。【这些数据是要处理一下转换为图片的，网上很多教程，去搜就行了】因为很简单，所以不多说，进入第二坑

# 开门第二坑：tf.data.TFRecordDataset()的使用

```python
tf.data.TFRecordDataset(filename)
```

我傻了吧唧的以为，这个可以直接把地址列表输入进去，它会自动按地址去读取那些对应的图片，事实证明我错的离谱……这个只会读取存有TFRecord文件地址的列表……所以才会报错：record被损坏……

这个`TFRecordDataset`里面的`filename`只能是`TFRecord`类型文件的地址==。

所以现在先进行数据预处理。

TFRecord是一种将图像数据和标签放在一起的二进制文件，适合以串行的方式读取大批量数据，虽然它的内部格式复杂，但是它可以很好地利用内存，方便地复制和移动，更符合TensorFlow执行引擎的方式。[该句来源](https://blog.csdn.net/JinbaoSite/article/details/75194226)

[代码参考博客](https://blog.csdn.net/hujiameihuxu/article/details/79944366)

关于代码中的`tf.python_io.TFRecordWriter(path, options=None)`，括号中间的`path`是填写转换好的内容的存储地址的,`option`是用来定义`TFRecord`文件保存的压缩格式的，是`TFRecordOptions`对象。[注意哦，TensorFlow的v2.0版本和v2.0以下版本的语法不同哟~反正我觉得TensorFlowv2.0的bug有点多，不敢用。而且我看了一下别人提交的push，好多是修改语法的……emmm还是等它稳定点，再试着用用吧。]

将普通图片数据转换成`TFRecord`格式数据需要注意的一点就是：读取`TFRecord`文件的时候，读取字典的`key`是要根据转换成`TFRecord`格式时候的字典的`key`对应上的。



【==我对tfrecord的理解有问题，需要修改==

好，接着进入第三坑。【暂缓

# 对TensorFlow不了解的坑

```py
y = tf.nn.dropout(x, dropout)
```

其中

x是输入的，需要dropout进行概率屏蔽的矩阵

dropout是概率，需要屏蔽哪些